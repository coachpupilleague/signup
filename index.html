<!doctype html>
<html lang="en">
  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="loadingspinner.css">

    <style>
      .invalid-tooltip-container {
        position: relative;
      }
      .invalid-tooltip {
        left: 0;
      }
      .form-group.required > label:after { 
        content:"*";
        color: #F00;
      }
      .red { 
        color: #F00;
      }
      #successful-submit {
        display: none;
        margin-top: 50px;
        font-size: 30px;
      }
      #loading-spinner {
        display: none;
      }
      .checkmark {
        color: green;
      }
      header {
        background-color: #061F48;
        color: #FFFFFF;
        text-align: center;
      }
      footer {
        background-color: #272828;
        color: #FFFFFF;
        box-shadow: 0 50vh 0 50vh #272828;
      }
      footer .discord-text {
        text-align: right;
      }
    </style>

    <title>CPL signup</title>
  </head>
  <body>

    <header class="py-2">
      <h1>CPL7 Signup form</h1>
    </header>

    <div class="container mt-2 mb-5">

      <div class="row">
        <div class="col-md-3 text-center">
          <img src="cpllogo.png" class="img-fluid" alt="Coach Pupil League Logo">
        </div>
        <div class="col-md-9">

          <form name="cpl-signup" action="https://script.google.com/macros/s/AKfycby6OMbOfo4Su-LTRLpkD9XuIrKSCWWij_JWwowsvXFVGCJc5155HFU5mNgaewbB6GXk/exec" method="POST">

            <div class="mb-3">Fields marked <span class="red">*</span> are required.</div>

            <!-- Account name -->
            <div class="form-group mb-4 required">
              <label for="account">Account name</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. lazersnipe" id="account" aria-describedby="account-help" name="account">
                <div class="invalid-tooltip">Please provide an account name</div>
              </div>
              <small id="account-help" class="form-text text-muted">The StarCraft account name you will be using during CPL.</small>
            </div>

            <!-- Discord account -->
            <div class="form-group mb-4 required">
              <label for="discord">Discord account</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. ~Medi~#1708" id="discord" aria-describedby="discord-help" name="discord">
                <div class="invalid-tooltip">Please provide a discord account in the format &lt;account&gt;#&lt;4 digit number&gt;</div>
              </div>
              <small id="discord-help" class="form-text text-muted">Your default discord account, consisting of your username and discriminator (a 4-digit number).</small>
            </div>

            <!-- CPL Discord account -->
            <div class="form-group mb-4 required">
              <label for="cpl-discord">CPL Discord account</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. Snipe" id="cpl-discord" aria-describedby="cpl-discord-help" name="cpl_discord">
                <div class="invalid-tooltip">Please provide a discord account name</div>
              </div>
              <small id="cpl-discord-help" class="form-text text-muted"> This is the screen name you will be using on Discord. Please try to use a discord name that is the same or similar to your StarCraft account name to make things easier for everyone.</small>
            </div>

            <!-- Role(s) -->
            <div class="form-group mb-4 required">
              <label>Role(s)</label>
              <div class="invalid-tooltip-container">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Player" id="player" name="roles[]">
                  <label class="form-check-label" for="player">
                    Player
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Coach" id="coach" name="roles[]">
                  <label class="form-check-label" for="coach">
                    Coach
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Assistant Coach" id="assistant_coach" name="roles[]">
                  <label class="form-check-label" for="assistant_coach">
                    Assistant Coach
                  </label>
                  <!-- the position of this tooltip is not optimal, because it actually concerns all checkboxes above -->
                  <div class="invalid-tooltip">Please check at least one</div>
                </div>
              </div>
              <small class="form-text text-muted">Coach/Assistant Coach/Player (You can sign-up for BOTH an Assistant Coach and Player if you meet the requirements, but you'll need to qualify for Tier 0 to be an Assistant Coach).</small>
            </div>

            <!-- MMR -->
            <div class="form-group mb-4 required">
              <label for="mmr">MMR</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. 1750" id="mmr" aria-describedby="mmr-help" name="mmr">
                <div class="invalid-tooltip">Please provide MMR (only a number with 3 or 4 digits)</div>
              </div>
              <small id="mmr-help" class="form-text text-muted"> Approximate MMR. If you haven't laddered on StarCraft Remastered before please make your best educated guess - or - enter 0000 and make a note about your estimated skill level/previous iccup rank in the additional info section. (Please note if you enter 0000 we may require replays or have you play some pre-preseason matches to help determine a baseline for what tier to place you in to best suit your skill level.</small>
            </div>

            <!-- Race -->
            <div class="form-group mb-4 required">
              <label for="race">Race</label>
              <select class="form-control" id="race" aria-describedby="race-help" name="race[]">
                <option value="Terran">Terran</option>
                <option value="Protoss">Protoss</option>
                <option value="Zerg">Zerg</option>
                <option value="Racepicker">Racepicker</option>
              </select>
              <small id="race-help" class="form-text text-muted">Main Race/Match-ups if race picker (Random is not allowed, but you can play a different race week-to-week if you wish - please select race picker if you intend to play more than 1 race during the season.).</small>
            </div>

            <!-- Racepicker matchups -->
            <div class="row d-none" id="js-racepicker-matchup-container">
              <div class="col-md-4">
                <div class="form-group mb-4 required">
                  <label for="vs-terran">vs. Terran</label>
                  <select class="form-control js-racepicker-matchup-select" id="vs-terran">
                    <option value="TvT">Terran (TvT)</option>
                    <option value="PvT">Protoss (PvT)</option>
                    <option value="ZvT">Zerg (ZvT)</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group mb-4 required">
                  <label for="vs-protoss">vs. Protoss</label>
                  <select class="form-control js-racepicker-matchup-select" id="vs-protoss">
                    <option value="TvP">Terran (TvP)</option>
                    <option value="PvP">Protoss (PvP)</option>
                    <option value="ZvP">Zerg (ZvP)</option>
                  </select>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-group mb-4 required">
                  <label for="vs-zerg">vs. Zerg</label>
                  <select class="form-control js-racepicker-matchup-select" id="vs-zerg">
                    <option value="TvZ">Terran (TvZ)</option>
                    <option value="PvZ">Protoss (PvZ)</option>
                    <option value="ZvZ">Zerg (ZvZ)</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Timezone -->
            <div class="form-group mb-4 required">
              <label for="timezone">Timezone</label>
              <select class="form-control" id="timezone" aria-describedby="timezone-help" name="timezone">
                <option value="(GMT-12:00)">(GMT-12:00) International Date Line West</option>
                <option value="(GMT-11:00)">(GMT-11:00) Midway Island, Samoa</option>
                <option value="(GMT-10:00)">(GMT-10:00) Hawaii</option>
                <option value="(GMT-09:00)">(GMT-09:00) Alaska</option>
                <option value="(GMT-08:00)">(GMT-08:00) Pacific Time (US & Canada)</option>
                <option value="(GMT-08:00)">(GMT-08:00) Tijuana, Baja California</option>
                <option value="(GMT-07:00)">(GMT-07:00) Arizona</option>
                <option value="(GMT-07:00)">(GMT-07:00) Chihuahua, La Paz, Mazatlan</option>
                <option value="(GMT-07:00)">(GMT-07:00) Mountain Time (US & Canada)</option>
                <option value="(GMT-06:00)">(GMT-06:00) Central America</option>
                <option value="(GMT-06:00)">(GMT-06:00) Central Time (US & Canada)</option>
                <option value="(GMT-05:00)">(GMT-05:00) Bogota, Lima, Quito, Rio Branco</option>
                <option value="(GMT-05:00)" selected>(GMT-05:00) Eastern Time (US & Canada)</option>
                <option value="(GMT-05:00)">(GMT-05:00) Indiana (East)</option>
                <option value="(GMT-04:00)">(GMT-04:00) Atlantic Time (Canada)</option>
                <option value="(GMT-04:00)">(GMT-04:00) Caracas, La Paz</option>
                <option value="(GMT-04:00)">(GMT-04:00) Manaus</option>
                <option value="(GMT-04:00)">(GMT-04:00) Santiago</option>
                <option value="(GMT-03:30)">(GMT-03:30) Newfoundland</option>
                <option value="(GMT-03:00)">(GMT-03:00) Brasilia</option>
                <option value="(GMT-03:00)">(GMT-03:00) Buenos Aires, Georgetown</option>
                <option value="(GMT-03:00)">(GMT-03:00) Greenland</option>
                <option value="(GMT-03:00)">(GMT-03:00) Montevideo</option>
                <option value="(GMT-02:00)">(GMT-02:00) Mid-Atlantic</option>
                <option value="(GMT-01:00)">(GMT-01:00) Cape Verde Is.</option>
                <option value="(GMT-01:00)">(GMT-01:00) Azores</option>
                <option value="(GMT+00:00)">(GMT+00:00) Casablanca, Monrovia, Reykjavik</option>
                <option value="(GMT+00:00)">(GMT+00:00) Greenwich Mean Time : Dublin, Edinburgh, Lisbon, London</option>
                <option value="(GMT+01:00)">(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna</option>
                <option value="(GMT+01:00)">(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague</option>
                <option value="(GMT+01:00)">(GMT+01:00) Brussels, Copenhagen, Madrid, Paris</option>
                <option value="(GMT+01:00)">(GMT+01:00) Sarajevo, Skopje, Warsaw, Zagreb</option>
                <option value="(GMT+01:00)">(GMT+01:00) West Central Africa</option>
                <option value="(GMT+02:00)">(GMT+02:00) Amman</option>
                <option value="(GMT+02:00)">(GMT+02:00) Athens, Bucharest, Istanbul</option>
                <option value="(GMT+02:00)">(GMT+02:00) Beirut</option>
                <option value="(GMT+02:00)">(GMT+02:00) Cairo</option>
                <option value="(GMT+02:00)">(GMT+02:00) Harare, Pretoria</option>
                <option value="(GMT+02:00)">(GMT+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius</option>
                <option value="(GMT+02:00)">(GMT+02:00) Jerusalem</option>
                <option value="(GMT+02:00)">(GMT+02:00) Minsk</option>
                <option value="(GMT+02:00)">(GMT+02:00) Windhoek</option>
                <option value="(GMT+03:00)">(GMT+03:00) Kuwait, Riyadh, Baghdad</option>
                <option value="(GMT+03:00)">(GMT+03:00) Moscow, St. Petersburg, Volgograd</option>
                <option value="(GMT+03:00)">(GMT+03:00) Nairobi</option>
                <option value="(GMT+03:00)">(GMT+03:00) Tbilisi</option>
                <option value="(GMT+03:30)">(GMT+03:30) Tehran</option>
                <option value="(GMT+04:00)">(GMT+04:00) Abu Dhabi, Muscat</option>
                <option value="(GMT+04:00)">(GMT+04:00) Baku</option>
                <option value="(GMT+04:00)">(GMT+04:00) Yerevan</option>
                <option value="(GMT+04:30)">(GMT+04:30) Kabul</option>
                <option value="(GMT+05:00)">(GMT+05:00) Yekaterinburg</option>
                <option value="(GMT+05:00)">(GMT+05:00) Islamabad, Karachi, Tashkent</option>
                <option value="(GMT+05:30)">(GMT+05:30) Sri Jayawardenapura</option>
                <option value="(GMT+05:30)">(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi</option>
                <option value="(GMT+05:45)">(GMT+05:45) Kathmandu</option>
                <option value="(GMT+06:00)">(GMT+06:00) Almaty, Novosibirsk</option>
                <option value="(GMT+06:00)">(GMT+06:00) Astana, Dhaka</option>
                <option value="(GMT+06:30)">(GMT+06:30) Yangon (Rangoon)</option>
                <option value="(GMT+07:00)">(GMT+07:00) Bangkok, Hanoi, Jakarta</option>
                <option value="(GMT+07:00)">(GMT+07:00) Krasnoyarsk</option>
                <option value="(GMT+08:00)">(GMT+08:00) Beijing, Chongqing, Hong Kong, Urumqi</option>
                <option value="(GMT+08:00)">(GMT+08:00) Kuala Lumpur, Singapore</option>
                <option value="(GMT+08:00)">(GMT+08:00) Irkutsk, Ulaan Bataar</option>
                <option value="(GMT+08:00)">(GMT+08:00) Perth</option>
                <option value="(GMT+08:00)">(GMT+08:00) Taipei</option>
                <option value="(GMT+09:00)">(GMT+09:00) Osaka, Sapporo, Tokyo</option>
                <option value="(GMT+09:00)">(GMT+09:00) Seoul</option>
                <option value="(GMT+09:00)">(GMT+09:00) Yakutsk</option>
                <option value="(GMT+09:30)">(GMT+09:30) Adelaide</option>
                <option value="(GMT+09:30)">(GMT+09:30) Darwin</option>
                <option value="(GMT+10:00)">(GMT+10:00) Brisbane</option>
                <option value="(GMT+10:00)">(GMT+10:00) Canberra, Melbourne, Sydney</option>
                <option value="(GMT+10:00)">(GMT+10:00) Hobart</option>
                <option value="(GMT+10:00)">(GMT+10:00) Guam, Port Moresby</option>
                <option value="(GMT+10:00)">(GMT+10:00) Vladivostok</option>
                <option value="(GMT+11:00)">(GMT+11:00) Magadan, Solomon Is., New Caledonia</option>
                <option value="(GMT+12:00)">(GMT+12:00) Auckland, Wellington</option>
                <option value="(GMT+12:00)">(GMT+12:00) Fiji, Kamchatka, Marshall Is.</option>
                <option value="(GMT+13:00)">(GMT+13:00) Nuku'alofa</option>
              </select>
              <small id="timezone-help" class="form-text text-muted">What is your timezone (This will greatly help us when creating teams to try our best to help get players in similar timezone to play with).</small>
            </div>

            <!-- Availability -->
            <div class="form-group mb-4 required">
              <label>Availability</label>
              <div class="invalid-tooltip-container">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Morning" id="availability1" name="availability[]">
                  <label class="form-check-label" for="availability1">
                    Morning (~6:00 - 12:00)
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Afternoon" id="availability2" name="availability[]">
                  <label class="form-check-label" for="availability2">
                    Afternoon (~12:00 - 18:00)
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Evening" id="availability3" name="availability[]">
                  <label class="form-check-label" for="availability3">
                    Evening (~18:00 - 0:00)
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Night" id="availability4" name="availability[]">
                  <label class="form-check-label" for="availability4">
                    Night (~0:00 - 6:00)
                  </label>
                  <!-- the position of this tooltip is not optimal, because it actually concerns all checkboxes above -->
                  <div class="invalid-tooltip">Please check at least one</div>
                </div>
              </div>
              <small class="form-text text-muted">Please select the times of day (in your own timezone) that you would be available to practice with your CPL team (more than one answer possible)</small>
            </div>

            <!-- Team Admin -->
            <div class="form-group mb-4">
              <label for="team-admin">Team Admin</label>
              <textarea class="form-control" rows="3" placeholder="e.g. I can help with handling the Administrating of the league!" id="team-admin" aria-describedby="team-admin-help" name="team-admin"></textarea>
              <small id="team-admin-help" class="form-text text-muted">If you'd like to be a Team Admin for your team (help handling team line-ups, reporting your teams scores) , or if you have any interest in volunteering for any other Admin work/casting etc. let us know.</small>
            </div>

            <!-- Additional info -->
            <div class="form-group mb-4">
              <label for="additional-info">Additional info</label>
              <textarea class="form-control" rows="3" placeholder="e.g. It doesn't matter what team I'm on, I want to help people improve!" id="additional-info" aria-describedby="additional-info-help" name="additional-info"></textarea>
              <small id="additional-info-help" class="form-text text-muted">Any additional additional-information we should know, such as having a couple players or a certain team you'd like to play with.</small>
            </div>

            <button type="submit" class="btn btn-primary" id="submit-button">Submit</button>

            <div id="loading-spinner">
              <div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
            </div>

          </form>

          <div id="successful-submit">
            <span class="checkmark">&check;</span>
            Form submitted successfully.
          </div>

        </div>
      </div>
    </div>

    <footer class="py-5">
      <div class="container">
        <div class="row">
          <div class="col">
          </div>
          <div class="col-lg-3 col-6">
            <div>
              <a href="https://discord.gg/6QEXQ8d" target="_blank">
                <img src="Discord-Logo+Wordmark-White.png" class="img-fluid" alt="Coach Pupil League Logo">
              </a>
            </div>
            <div class="discord-text">
              Please join the <a href="https://discord.gg/6QEXQ8d" target="_blank">CPL Discord</a> for all required information
            </div>
          </div>
        </div>
      </div>
    </footer>

    <script type="text/javascript" src="helper_functions.js"></script>

    <!-- based on https://github.com/rickharrison/validate.js -->
    <!-- fixing PR: https://github.com/beijaflor/validate.js -->
    <script type="text/javascript" src="validate.js"></script>

    <script>
      const form = document.forms['cpl-signup'];
      const successfulSubmit = document.getElementById('successful-submit');
      const loadingSpinner = document.getElementById('loading-spinner');
      const submitButton = document.getElementById('submit-button');
      const racepickerMatchupContainer = document.getElementById('js-racepicker-matchup-container');
      const racepickerMatchupSelects = Array.from(document.getElementsByClassName('js-racepicker-matchup-select'));

      var removeIsInvalidFromThis = function() {
        this.classList.remove("is-invalid");
        this.removeEventListener('focus', removeIsInvalidFromThis);
      }
      
      var removeIsInvalidFromAllNearInputs = function() {
        var allNearInputs = this.closest('.form-group').querySelectorAll('input');
        for (el of allNearInputs) {
          el.classList.remove("is-invalid");
          el.removeEventListener('focus', removeIsInvalidFromAllNearInputs);
        }
      }

      form.race.addEventListener('change', (event) => {
        if (event.target.value === 'Racepicker') {
          racepickerMatchupContainer.classList.remove("d-none");
          racepickerMatchupSelects.map(select => select.setAttribute('name', 'race[]'));
        } else {
          racepickerMatchupContainer.classList.add("d-none");
          racepickerMatchupSelects.map(select => select.removeAttribute('name'));
        }
      });

      var validator = new FormValidator('cpl-signup', [{
        name: 'account',
        rules: 'required'
      }, {
        name: 'discord',
        rules: 'required|callback_validateDiscord'
      }, {
        name: 'cpl_discord',
        rules: 'required'
      }, {
        name: 'roles[]',
        rules: 'required'
      }, {
        name: 'availability[]',
        rules: 'required'
      }, {
        name: 'mmr',
        rules: 'required|integer|greater_than[0]|less_than[10000]'
      }], function(errors, event) {
        event.preventDefault();

        if (errors.length > 0) {
          for (error of errors) {
            var element = error.element;
            if (Symbol.iterator in Object(element)) {
              for (el of element) {
                el.classList.add("is-invalid");
                el.addEventListener('focus', removeIsInvalidFromAllNearInputs);
              }
            } else {
              element.classList.add("is-invalid");
              element.addEventListener('focus', removeIsInvalidFromThis);
            }
          }
        } else {
          
          submitButton.style.display = 'none';
          loadingSpinner.style.display = 'block';

          var formData = new FormData(form);
          for (entry of formData.entries()) {
            var key = entry[0];
            var value = entry[1];
            formData.set(key, sanitize(value));
          }

          fetch(form.action, { method: 'POST', body: new FormData(form) })
            .then(response => response.json())
            .then(response => { form.style.display = 'none'; successfulSubmit.style.display = 'block'; })
            .catch(error => console.error('Error!', error.message))
        }
      }).registerCallback('validateDiscord', callback_validateDiscord);

    </script>

  </body>
</html>
