<!doctype html>
<html lang="en">
  <head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <link rel="stylesheet" href="loadingspinner.css">

    <style>
      .invalid-tooltip-container {
        position: relative;
      }
      .invalid-tooltip {
        left: 0;
      }
      .form-group .required > label:after { 
        content:"*";
      }
      #successful-submit {
        display: none;
        margin-top: 50px;
        font-size: 30px;
      }
      #loading-spinner {
        display: none;
      }
      .checkmark {
        color: green;
      }
    </style>

    <title>CPL signup</title>
  </head>
  <body>

    <div class="container mt-md-5 mb-md-5">
      <div class="row">
        <div class="col-md-3 text-center">
          <img src="cpllogo.png" class="img-fluid" alt="Coach Pupil League Logo">
        </div>
        <div class="col-md-9">

          <form name="cpl-signup" action="https://script.google.com/macros/s/AKfycby6OMbOfo4Su-LTRLpkD9XuIrKSCWWij_JWwowsvXFVGCJc5155HFU5mNgaewbB6GXk/exec" method="POST">

            <!-- Account name -->
            <div class="form-group mb-4 required">
              <label for="account">Account name</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. lazersnipe" id="account" aria-describedby="account-help" name="account">
                <div class="invalid-tooltip">Please provide an account name</div>
              </div>
              <small id="account-help" class="form-text text-muted">The StarCraft account name you will be using during CPL.</small>
            </div>

            <!-- Discord account -->
            <div class="form-group mb-4 required">
              <label for="discord">Discord account</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. ~Medi~#1708" id="discord" aria-describedby="discord-help" name="discord">
                <div class="invalid-tooltip">Please provide a discord account in the format &lt;account&gt;#&lt;4 digit number&gt;</div>
              </div>
              <small id="discord-help" class="form-text text-muted">Your default discord account, consisting of your username and discriminator (a 4-digit number).</small>
            </div>

            <!-- CPL Discord account -->
            <div class="form-group mb-4 required">
              <label for="cpl-discord">CPL Discord account</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. Snipe" id="cpl-discord" aria-describedby="cpl-discord-help" name="cpl_discord">
                <div class="invalid-tooltip">Please provide a discord account name</div>
              </div>
              <small id="cpl-discord-help" class="form-text text-muted">Discord account you will be joining the discord with. Please use a discord name that is the same or similar to your StarCraft account name to make things easier for everyone.</small>
            </div>

            <!-- Role(s) -->
            <div class="form-group mb-4 required">
              <label>Role(s)</label>
              <div class="invalid-tooltip-container">
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="player" id="player" name="roles[]">
                  <label class="form-check-label" for="player">
                    Player
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="coach" id="coach" name="roles[]">
                  <label class="form-check-label" for="coach">
                    Coach
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="assistant_coach" id="assistant_coach" name="roles[]">
                  <label class="form-check-label" for="assistant_coach">
                    Assistant Coach
                  </label>
                  <!-- the position of this tooltip is not optimal, because it actually concerns all checkboxes above -->
                  <div class="invalid-tooltip">Please check at least one</div>
                </div>
              </div>
              <small class="form-text text-muted">Coach/Assistant Coach/Player (You can sign-up for BOTH an Assistant Coach and Player if you meet the requirements, but you'll need to qualify for Tier 0 to be an Assistant Coach).</small>
            </div>

            <!-- MMR -->
            <div class="form-group mb-4 required">
              <label for="mmr">MMR</label>
              <div class="invalid-tooltip-container">
                <input class="form-control" type="text" placeholder="e.g. 1750" id="mmr" aria-describedby="mmr-help" name="mmr">
                <div class="invalid-tooltip">Please provide MMR</div>
              </div>
              <small id="mmr-help" class="form-text text-muted">Approximate MMR (if you haven't laddered on StarCraft Remastered you can use an old ICCUP rank, or best guess).</small>
            </div>

            <!-- Race -->
            <div class="form-group mb-4 required">
              <label for="race">Race</label>
              <select class="form-control" id="race" aria-describedby="race-help" name="race">
                <option>Terran</option>
                <option>Protoss</option>
                <option>Zerg</option>
                <option>Racepicker</option>
              </select>
              <small id="race-help" class="form-text text-muted">Main Race/Match-ups if race picker (Random is not allowed, but you can play a different race week-to-week if you wish).</small>
            </div>

            <!-- Timezone -->
            <div class="form-group mb-4 required">
              <label for="timezone">Timezone</label>
              <select class="form-control" id="timezone" aria-describedby="timezone-help" name="timezone">
                <option value="-12">(GMT-12:00) International Date Line West</option>
                <option value="-11">(GMT-11:00) Midway Island, Samoa</option>
                <option value="-10">(GMT-10:00) Hawaii</option>
                <option value="-9">(GMT-09:00) Alaska</option>
                <option value="-8">(GMT-08:00) Pacific Time (US & Canada)</option>
                <option value="-8">(GMT-08:00) Tijuana, Baja California</option>
                <option value="-7">(GMT-07:00) Arizona</option>
                <option value="-7">(GMT-07:00) Chihuahua, La Paz, Mazatlan</option>
                <option value="-7">(GMT-07:00) Mountain Time (US & Canada)</option>
                <option value="-6">(GMT-06:00) Central America</option>
                <option value="-6">(GMT-06:00) Central Time (US & Canada)</option>
                <option value="-5">(GMT-05:00) Bogota, Lima, Quito, Rio Branco</option>
                <option value="-5" selected>(GMT-05:00) Eastern Time (US & Canada)</option>
                <option value="-5">(GMT-05:00) Indiana (East)</option>
                <option value="-4">(GMT-04:00) Atlantic Time (Canada)</option>
                <option value="-4">(GMT-04:00) Caracas, La Paz</option>
                <option value="-4">(GMT-04:00) Manaus</option>
                <option value="-4">(GMT-04:00) Santiago</option>
                <option value="-3.5">(GMT-03:30) Newfoundland</option>
                <option value="-3">(GMT-03:00) Brasilia</option>
                <option value="-3">(GMT-03:00) Buenos Aires, Georgetown</option>
                <option value="-3">(GMT-03:00) Greenland</option>
                <option value="-3">(GMT-03:00) Montevideo</option>
                <option value="-2">(GMT-02:00) Mid-Atlantic</option>
                <option value="-1">(GMT-01:00) Cape Verde Is.</option>
                <option value="-1">(GMT-01:00) Azores</option>
                <option value="0">(GMT+00:00) Casablanca, Monrovia, Reykjavik</option>
                <option value="0">(GMT+00:00) Greenwich Mean Time : Dublin, Edinburgh, Lisbon, London</option>
                <option value="1">(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna</option>
                <option value="1">(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague</option>
                <option value="1">(GMT+01:00) Brussels, Copenhagen, Madrid, Paris</option>
                <option value="1">(GMT+01:00) Sarajevo, Skopje, Warsaw, Zagreb</option>
                <option value="1">(GMT+01:00) West Central Africa</option>
                <option value="2">(GMT+02:00) Amman</option>
                <option value="2">(GMT+02:00) Athens, Bucharest, Istanbul</option>
                <option value="2">(GMT+02:00) Beirut</option>
                <option value="2">(GMT+02:00) Cairo</option>
                <option value="2">(GMT+02:00) Harare, Pretoria</option>
                <option value="2">(GMT+02:00) Helsinki, Kyiv, Riga, Sofia, Tallinn, Vilnius</option>
                <option value="2">(GMT+02:00) Jerusalem</option>
                <option value="2">(GMT+02:00) Minsk</option>
                <option value="2">(GMT+02:00) Windhoek</option>
                <option value="3">(GMT+03:00) Kuwait, Riyadh, Baghdad</option>
                <option value="3">(GMT+03:00) Moscow, St. Petersburg, Volgograd</option>
                <option value="3">(GMT+03:00) Nairobi</option>
                <option value="3">(GMT+03:00) Tbilisi</option>
                <option value="3.5">(GMT+03:30) Tehran</option>
                <option value="4">(GMT+04:00) Abu Dhabi, Muscat</option>
                <option value="4">(GMT+04:00) Baku</option>
                <option value="4">(GMT+04:00) Yerevan</option>
                <option value="4.5">(GMT+04:30) Kabul</option>
                <option value="5">(GMT+05:00) Yekaterinburg</option>
                <option value="5">(GMT+05:00) Islamabad, Karachi, Tashkent</option>
                <option value="5.5">(GMT+05:30) Sri Jayawardenapura</option>
                <option value="5.5">(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi</option>
                <option value="5.75">(GMT+05:45) Kathmandu</option>
                <option value="6">(GMT+06:00) Almaty, Novosibirsk</option>
                <option value="6">(GMT+06:00) Astana, Dhaka</option>
                <option value="6.5">(GMT+06:30) Yangon (Rangoon)</option>
                <option value="7">(GMT+07:00) Bangkok, Hanoi, Jakarta</option>
                <option value="7">(GMT+07:00) Krasnoyarsk</option>
                <option value="8">(GMT+08:00) Beijing, Chongqing, Hong Kong, Urumqi</option>
                <option value="8">(GMT+08:00) Kuala Lumpur, Singapore</option>
                <option value="8">(GMT+08:00) Irkutsk, Ulaan Bataar</option>
                <option value="8">(GMT+08:00) Perth</option>
                <option value="8">(GMT+08:00) Taipei</option>
                <option value="9">(GMT+09:00) Osaka, Sapporo, Tokyo</option>
                <option value="9">(GMT+09:00) Seoul</option>
                <option value="9">(GMT+09:00) Yakutsk</option>
                <option value="9.5">(GMT+09:30) Adelaide</option>
                <option value="9.5">(GMT+09:30) Darwin</option>
                <option value="10">(GMT+10:00) Brisbane</option>
                <option value="10">(GMT+10:00) Canberra, Melbourne, Sydney</option>
                <option value="10">(GMT+10:00) Hobart</option>
                <option value="10">(GMT+10:00) Guam, Port Moresby</option>
                <option value="10">(GMT+10:00) Vladivostok</option>
                <option value="11">(GMT+11:00) Magadan, Solomon Is., New Caledonia</option>
                <option value="12">(GMT+12:00) Auckland, Wellington</option>
                <option value="12">(GMT+12:00) Fiji, Kamchatka, Marshall Is.</option>
                <option value="13">(GMT+13:00) Nuku'alofa</option>
              </select>
              <small id="timezone-help" class="form-text text-muted">What is your timezone (This will greatly help us when creating teams to try our best to help get players in similar timezone to play with).</small>
            </div>

            <!-- Team Admin -->
            <div class="form-group mb-4">
              <label for="team-admin">Team Admin</label>
              <textarea class="form-control" rows="3" placeholder="e.g. I can help with handling the Administrating of the league!" id="team-admin" aria-describedby="team-admin-help" name="team-admin"></textarea>
              <small id="team-admin-help" class="form-text text-muted">If you'd like to be a Team Admin for your team (help handling team line-ups, reporting your teams scores) , or if you have any interest in volunteering for any other Admin work/casting etc. let us know.</small>
            </div>

            <!-- Additional info -->
            <div class="form-group mb-4">
              <label for="additional-info">Additional info</label>
              <textarea class="form-control" rows="3" placeholder="e.g. It doesn't matter what team I'm on, I want to help people improve!" id="additional-info" aria-describedby="additional-info-help" name="additional-info"></textarea>
              <small id="additional-info-help" class="form-text text-muted">Any additional additional-information we should know, such as having a couple players or a certain team you'd like to play with.</small>
            </div>

            <button type="submit" class="btn btn-primary" id="submit-button">Submit</button>

            <div id="loading-spinner">
              <div class="lds-spinner"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
            </div>

          </form>

          <div id="successful-submit">
            <span class="checkmark">&check;</span>
            Form submitted successfully.
          </div>

        </div>
      </div>
    </div>

    <!-- https://github.com/rickharrison/validate.js -->
    <script type="text/javascript" src="validate.min.js"></script>

    <script>
      const form = document.forms['cpl-signup'];
      const successfulSubmit = document.getElementById('successful-submit');
      const loadingSpinner = document.getElementById('loading-spinner');
      const submitButton = document.getElementById('submit-button');

      var removeIsInvalidFromThis = function() {
        this.classList.remove("is-invalid");
        this.removeEventListener('focus', removeIsInvalidFromThis);
      }
      
      var removeIsInvalidFromAllNearInputs = function() {
        var allNearInputs = this.closest('.form-group').querySelectorAll('input');
        for (el of allNearInputs) {
          el.classList.remove("is-invalid");
          el.removeEventListener('focus', removeIsInvalidFromAllNearInputs);
        }
      }

      var callback_validateDiscord = function(value) {
        // validating discord names with regex
        return /^[^#@\:]*#\d{4}$/.test(value);
      }

      var validator = new FormValidator('cpl-signup', [{
        name: 'account',
        rules: 'required'
      }, {
        name: 'discord',
        rules: 'required|callback_validateDiscord'
      }, {
        name: 'cpl_discord',
        rules: 'required'
      }, {
        name: 'roles[]',
        rules: 'required'
      }, {
        name: 'mmr',
        rules: 'required'
      }], function(errors, event) {
        event.preventDefault();

        if (errors.length > 0) {
          for (error of errors) {
            var element = error.element;
            if (Symbol.iterator in Object(element)) {
              for (el of element) {
                el.classList.add("is-invalid");
                el.addEventListener('focus', removeIsInvalidFromAllNearInputs);
              }
            } else {
              element.classList.add("is-invalid");
              element.addEventListener('focus', removeIsInvalidFromThis);
            }
          }
        } else {
          
          submitButton.style.display = 'none';
          loadingSpinner.style.display = 'block';

          fetch(form.action, { method: 'POST', body: new FormData(form) })
            .then(response => response.json())
            .then(response => { form.style.display = 'none'; successfulSubmit.style.display = 'block'; })
            .catch(error => console.error('Error!', error.message))
        }
      }).registerCallback('validateDiscord', callback_validateDiscord);

    </script>

  </body>
</html>
